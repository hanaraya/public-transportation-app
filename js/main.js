!function t(e,n,r){function i(a,u){if(!n[a]){if(!e[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};e[a][0].call(d.exports,function(t){var n=e[a][1][t];return i(n?n:t)},d,d.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(t,e,n){"use strict";!function(){function t(t){return Array.prototype.slice.call(t)}function n(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function r(t,e,r){var i,o=new Promise(function(o,a){i=t[e].apply(t,r),n(i).then(o,a)});return o.request=i,o}function i(t,e,n){var i=r(t,e,n);return i.then(function(t){return t?new d(t,i.request):void 0})}function o(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]}})})}function a(t,e,n,i){i.forEach(function(i){i in n.prototype&&(t.prototype[i]=function(){return r(this[e],i,arguments)})})}function u(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function s(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return i(this[e],r,arguments)})})}function c(t){this._index=t}function d(t,e){this._cursor=t,this._request=e}function f(t){this._store=t}function l(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)}})}function p(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new l(n)}function v(t){this._db=t}o(c,"_index",["name","keyPath","multiEntry","unique"]),a(c,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),s(c,"_index",IDBIndex,["openCursor","openKeyCursor"]),o(d,"_cursor",["direction","key","primaryKey","value"]),a(d,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(d.prototype[t]=function(){var e=this,r=arguments;return Promise.resolve().then(function(){return e._cursor[t].apply(e._cursor,r),n(e._request).then(function(t){return t?new d(t,e._request):void 0})})})}),f.prototype.createIndex=function(){return new c(this._store.createIndex.apply(this._store,arguments))},f.prototype.index=function(){return new c(this._store.index.apply(this._store,arguments))},o(f,"_store",["name","keyPath","indexNames","autoIncrement"]),a(f,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getAllKeys","count"]),s(f,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),u(f,"_store",IDBObjectStore,["deleteIndex"]),l.prototype.objectStore=function(){return new f(this._tx.objectStore.apply(this._tx,arguments))},o(l,"_tx",["objectStoreNames","mode"]),u(l,"_tx",IDBTransaction,["abort"]),p.prototype.createObjectStore=function(){return new f(this._db.createObjectStore.apply(this._db,arguments))},o(p,"_db",["name","version","objectStoreNames"]),u(p,"_db",IDBDatabase,["deleteObjectStore","close"]),v.prototype.transaction=function(){return new l(this._db.transaction.apply(this._db,arguments))},o(v,"_db",["name","version","objectStoreNames"]),u(v,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[f,c].forEach(function(n){n.prototype[e.replace("open","iterate")]=function(){var n=t(arguments),r=n[n.length-1],i=(this._store||this._index)[e].apply(this._store,n.slice(0,-1));i.onsuccess=function(){r(i.result)}}})}),[c,f].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise(function(i){n.iterateCursor(t,function(t){return t?(r.push(t.value),void 0!==e&&r.length==e?void i(r):void t["continue"]()):void i(r)})})})});var h={open:function(t,e,n){var i=r(indexedDB,"open",[t,e]),o=i.request;return o.onupgradeneeded=function(t){n&&n(new p(o.result,t.oldVersion,o.transaction))},i.then(function(t){return new v(t)})},"delete":function(t){return r(indexedDB,"deleteDatabase",[t])}};"undefined"!=typeof e?e.exports=h:self.idb=h}()},{}],2:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t){var e=t["@attributes"].origTimeDate+" "+t["@attributes"].origTimeMin,n=new Date(e),r=t["@attributes"].destTimeDate+" "+t["@attributes"].destTimeMin,i=new Date(r),o=(i-n)/6e4;return"12:00 AM"===t["@attributes"].origTimeMin&&(o-=1440),"12:00 AM"===t["@attributes"].destTimeMin&&(o+=1440),o}function o(t){var e=[],n=[],r={},o={};return t.forEach(function(t){o={},n=[],t.leg.forEach?t.leg.forEach(function(t){r={origTimeMin:t["@attributes"].origTimeMin,destTimeMin:t["@attributes"].destTimeMin,origin:t["@attributes"].origin,destination:t["@attributes"].destination,order:t["@attributes"].order,duration:i(t)},n.push(r)}):(r={origTimeMin:t.leg["@attributes"].origTimeMin,destTimeMin:t.leg["@attributes"].destTimeMin,origin:t.leg["@attributes"].origin,destination:t.leg["@attributes"].destination,order:t.leg["@attributes"].order},n.push(r)),o={duration:i(t),leg:n},e.push(o)}),e}function a(t){return fetch(t).then(function(t){return t.text().then(function(t){var e=new DOMParser;return e.parseFromString(t,"text/xml")})})}function u(t){return a(t).then(function(t){return p(t)})}function s(){return u(O).then(function(t){f(t.root.stations.station),v().then(function(e){if(e){var n=e.transaction("stations","readwrite").objectStore("stations");n.clear().then(function(){t.root.stations.station.forEach(function(t){t.id=t.abbr["#text"],n.put(t)})})}})})}function c(){return v().then(function(t){if(t){var e=t.transaction("stations").objectStore("stations");e.getAll().then(function(t){f(t)});var n,r,i=t.transaction("default").objectStore("default");i.get("from").then(function(t){t&&(n=t.value,t&&(j.value=t.displayValue),n&&r&&h(n,r))}),i.get("to").then(function(t){t&&(r=t.value,t&&(I.value=t.displayValue),n&&r&&h(n,r))})}})}function d(t,e){if(!t||!e)return null;if(t[e.toUpperCase()])return e.toUpperCase();for(var n in t)if(t[n].toUpperCase()===e.toUpperCase())return n;return null}function f(t){C="",P={},t.forEach(function(t){C+=q.replace("%value-data%",t.name["#text"]).replaceAll("%abbr-data%",t.abbr["#text"]),P[t.abbr["#text"]]=t.name["#text"]}),B.innerHTML=C}function l(){navigator.serviceWorker&&navigator.serviceWorker.register("sw.js",{scope:"/"}).then(function(t){})["catch"](function(t){})}function p(t){var e={};if(1==t.nodeType){if(t.attributes.length>0){e["@attributes"]={};for(var n=0;n<t.attributes.length;n++){var r=t.attributes.item(n);e["@attributes"][r.nodeName]=r.nodeValue}}}else 3==t.nodeType&&(e=t.nodeValue);if(t.hasChildNodes())for(var i=0;i<t.childNodes.length;i++){var o=t.childNodes.item(i),a=o.nodeName;if("undefined"==typeof e[a])e[a]=p(o);else{if("undefined"==typeof e[a].push){var u=e[a];e[a]=[],e[a].push(u)}e[a].push(p(o))}}return e}function v(){return navigator.serviceWorker?M["default"].open("bart",1,function(t){switch(t.version){case 1:t.createObjectStore("stations",{keyPath:"id"}),t.createObjectStore("schedule",{keyPath:["from","to"]}),t.createObjectStore("default",{keyPath:"id"})}}):Promise.resolve()}function h(t,e){t&&e&&y(t,e).then(function(){m(t,e)})}function g(t){var e=j.value,n=I.value;if(e&&n){var r=d(P,e);r?S(j,!1):S(j,!0);var i=d(P,n);r&&i?(h(r,i),b(e,n)):D()}}function b(t,e){v().then(function(n){var r=n.transaction("default","readwrite").objectStore("default"),i={id:"from",displayValue:t,value:d(P,t)},o={id:"to",displayValue:e,value:d(P,e)};r.put(i),r.put(o)})}function m(t,e){if(t&&e){var n=new Request(V.replace("%orig%",t).replace("%dest%",e));u(n).then(function(n){if(n.root.schedule.request){var r=o(n.root.schedule.request.trip);return x(r),v().then(function(n){if(n){var i=r;i.from=t,i.to=e;var o=n.transaction("schedule","readwrite").objectStore("schedule");o.put(i)}})}})["catch"](function(t){})}}function y(t,e){return v().then(function(n){if(n){var r=n.transaction("schedule").objectStore("schedule"),i=[t,e];return r.get(i).then(function(t){t?x(t):D()})["catch"](function(t){D()})}})}function _(t){return t?W.replace("%depart-time%",t.origTimeMin).replace("%arrival-time%",t.destTimeMin).replace("%from-station%",P[t.origin]).replace("%to-station%",P[t.destination]).replace("%from-abbr%",t.origin).replace("%to-abbr%",t.destination):void 0}function x(t){N=!0,L="",t.forEach(function(t){var e="";if(t.leg.forEach)t.leg.forEach(function(n){""!==e&&(e+=F);var r="";r=1==t.leg.length?_(n).replace("<div><strong>Leg %leg-number%</strong></div>","").replace("<div><strong>Leg Duration:</strong> %leg-duration% mins</div>",""):_(n).replace("%leg-number%",n.order).replace("%leg-duration%",n.duration),e+=r});else{var n=_(t.leg).replace("<strong>Leg %leg-number%</strong>","");e+=n}L+=K.replace("%trip-duration%",t.duration)+e+U}),A.innerHTML=L}function D(){N&&(N=!1,A.innerHTML=k)}function E(t){var e=j.value,n=I.value;if(e&&n){var r=d(P,e),i=d(P,n);i?S(I,!1):S(I,!0),r&&i?(h(r,i),b(e,n)):D()}}function w(){j.addEventListener("input",g),I.addEventListener("input",E)}function S(t,e){!e&&t.getAttribute("aria-invalid")?t.removeAttribute("aria-invalid"):e&&!t.getAttribute("aria-invalid")&&t.setAttribute("aria-invalid","true")}var T=t("idb"),M=r(T),j=document.getElementById("from-station"),I=document.getElementById("to-station"),A=document.getElementById("replace-me"),B=document.getElementById("station-list"),q='<option value="%value-data%" abbreviation="%abbr-data%">%abbr-data%</option>',C="",O=new Request("http://api.bart.gov/api/stn.aspx?cmd=stns&key=MW9S-E7SL-26DU-VV8V"),P={},V="http://api.bart.gov/api/sched.aspx?cmd=depart&orig=%orig%&dest=%dest%&key=MW9S-E7SL-26DU-VV8V",L="",k="<div>Schedule not available</div>",N=!0,K='<div class="display-section"><strong>Trip Duration:</strong> %trip-duration% mins',U="</div>",W='<div class="flex-container flex-horizontal"><div class = "flex-2"><div><strong>Leg %leg-number%</strong></div><div><strong>From:</strong> %from-station% (%from-abbr%)</div><div><strong>Departure:</strong> %depart-time%</div></div><div class = "flex-1"><div><strong>Leg Duration:</strong> %leg-duration% mins</div><div><strong>To:</strong> %to-station% (%to-abbr%)</div><div><strong>Arrival:</strong> %arrival-time%</div></div></div>',F="<hr>";String.prototype.replaceAll=function(t,e){var n=this;return n.replace(new RegExp(t,"g"),e)},w(),l(),c().then(function(){s()})["catch"](function(t){s()})},{idb:1}]},{},[2]);