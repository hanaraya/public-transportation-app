{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["!function t(e,n,r){function o(a,u){if(!n[a]){if(!e[a]){var s=\"function\"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error(\"Cannot find module '\"+a+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var d=n[a]={exports:{}};e[a][0].call(d.exports,function(t){var n=e[a][1][t];return o(n?n:t)},d,d.exports,t,e,n,r)}return n[a].exports}for(var i=\"function\"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){\"use strict\";!function(){function t(t){return Array.prototype.slice.call(t)}function n(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function r(t,e,r){var o,i=new Promise(function(i,a){o=t[e].apply(t,r),n(o).then(i,a)});return i.request=o,i}function o(t,e,n){var o=r(t,e,n);return o.then(function(t){return t?new d(t,o.request):void 0})}function i(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]}})})}function a(t,e,n,o){o.forEach(function(o){o in n.prototype&&(t.prototype[o]=function(){return r(this[e],o,arguments)})})}function u(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})})}function s(t,e,n,r){r.forEach(function(r){r in n.prototype&&(t.prototype[r]=function(){return o(this[e],r,arguments)})})}function c(t){this._index=t}function d(t,e){this._cursor=t,this._request=e}function f(t){this._store=t}function l(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)}})}function p(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new l(n)}function v(t){this._db=t}i(c,\"_index\",[\"name\",\"keyPath\",\"multiEntry\",\"unique\"]),a(c,\"_index\",IDBIndex,[\"get\",\"getKey\",\"getAll\",\"getAllKeys\",\"count\"]),s(c,\"_index\",IDBIndex,[\"openCursor\",\"openKeyCursor\"]),i(d,\"_cursor\",[\"direction\",\"key\",\"primaryKey\",\"value\"]),a(d,\"_cursor\",IDBCursor,[\"update\",\"delete\"]),[\"advance\",\"continue\",\"continuePrimaryKey\"].forEach(function(t){t in IDBCursor.prototype&&(d.prototype[t]=function(){var e=this,r=arguments;return Promise.resolve().then(function(){return e._cursor[t].apply(e._cursor,r),n(e._request).then(function(t){return t?new d(t,e._request):void 0})})})}),f.prototype.createIndex=function(){return new c(this._store.createIndex.apply(this._store,arguments))},f.prototype.index=function(){return new c(this._store.index.apply(this._store,arguments))},i(f,\"_store\",[\"name\",\"keyPath\",\"indexNames\",\"autoIncrement\"]),a(f,\"_store\",IDBObjectStore,[\"put\",\"add\",\"delete\",\"clear\",\"get\",\"getAll\",\"getAllKeys\",\"count\"]),s(f,\"_store\",IDBObjectStore,[\"openCursor\",\"openKeyCursor\"]),u(f,\"_store\",IDBObjectStore,[\"deleteIndex\"]),l.prototype.objectStore=function(){return new f(this._tx.objectStore.apply(this._tx,arguments))},i(l,\"_tx\",[\"objectStoreNames\",\"mode\"]),u(l,\"_tx\",IDBTransaction,[\"abort\"]),p.prototype.createObjectStore=function(){return new f(this._db.createObjectStore.apply(this._db,arguments))},i(p,\"_db\",[\"name\",\"version\",\"objectStoreNames\"]),u(p,\"_db\",IDBDatabase,[\"deleteObjectStore\",\"close\"]),v.prototype.transaction=function(){return new l(this._db.transaction.apply(this._db,arguments))},i(v,\"_db\",[\"name\",\"version\",\"objectStoreNames\"]),u(v,\"_db\",IDBDatabase,[\"close\"]),[\"openCursor\",\"openKeyCursor\"].forEach(function(e){[f,c].forEach(function(n){n.prototype[e.replace(\"open\",\"iterate\")]=function(){var n=t(arguments),r=n[n.length-1],o=(this._store||this._index)[e].apply(this._store,n.slice(0,-1));o.onsuccess=function(){r(o.result)}}})}),[c,f].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,r=[];return new Promise(function(o){n.iterateCursor(t,function(t){return t?(r.push(t.value),void 0!==e&&r.length==e?void o(r):void t[\"continue\"]()):void o(r)})})})});var h={open:function(t,e,n){var o=r(indexedDB,\"open\",[t,e]),i=o.request;return i.onupgradeneeded=function(t){n&&n(new p(i.result,t.oldVersion,i.transaction))},o.then(function(t){return new v(t)})},\"delete\":function(t){return r(indexedDB,\"deleteDatabase\",[t])}};\"undefined\"!=typeof e?e.exports=h:self.idb=h}()},{}],2:[function(t,e,n){\"use strict\";function r(t){return t&&t.__esModule?t:{\"default\":t}}function o(t){var e=t[\"@attributes\"].origTimeDate+\" \"+t[\"@attributes\"].origTimeMin,n=new Date(e),r=t[\"@attributes\"].destTimeDate+\" \"+t[\"@attributes\"].destTimeMin,o=new Date(r),i=(o-n)/6e4;return i}function i(t){var e=[],n=[],r={},i={};return t.forEach(function(t){i={},n=[],t.leg.forEach?t.leg.forEach(function(t){r={origTimeMin:t[\"@attributes\"].origTimeMin,destTimeMin:t[\"@attributes\"].destTimeMin,origin:t[\"@attributes\"].origin,destination:t[\"@attributes\"].destination,order:t[\"@attributes\"].order,duration:o(t)},n.push(r)}):(r={origTimeMin:t.leg[\"@attributes\"].origTimeMin,destTimeMin:t.leg[\"@attributes\"].destTimeMin,origin:t.leg[\"@attributes\"].origin,destination:t.leg[\"@attributes\"].destination,order:t.leg[\"@attributes\"].order},n.push(r)),i={duration:o(t),leg:n},e.push(i)}),e}function a(t){return fetch(t).then(function(t){return t.text().then(function(t){var e=new DOMParser;return e.parseFromString(t,\"text/xml\")})})}function u(t){return a(t).then(function(t){return p(t)})}function s(){return u(O).then(function(t){f(t.root.stations.station),v().then(function(e){if(e){var n=e.transaction(\"stations\",\"readwrite\").objectStore(\"stations\");n.clear().then(function(){t.root.stations.station.forEach(function(t){t.id=t.abbr[\"#text\"],n.put(t)})})}})})}function c(){return v().then(function(t){if(t){var e=t.transaction(\"stations\").objectStore(\"stations\");e.getAll().then(function(t){f(t)});var n,r,o=t.transaction(\"default\").objectStore(\"default\");o.get(\"from\").then(function(t){t&&(n=t.value,t&&(I.value=t.displayValue),n&&r&&h(n,r))}),o.get(\"to\").then(function(t){t&&(r=t.value,t&&(M.value=t.displayValue),n&&r&&h(n,r))})}})}function d(t,e){if(!t||!e)return null;if(t[e.toUpperCase()])return e.toUpperCase();for(var n in t)if(t[n].toUpperCase()===e.toUpperCase())return n;return null}function f(t){C=\"\",P={},t.forEach(function(t){C+=A.replace(\"%value-data%\",t.name[\"#text\"]).replaceAll(\"%abbr-data%\",t.abbr[\"#text\"]),P[t.abbr[\"#text\"]]=t.name[\"#text\"]}),q.innerHTML=C}function l(){navigator.serviceWorker&&navigator.serviceWorker.register(\"sw.js\",{scope:\"/\"}).then(function(t){})[\"catch\"](function(t){})}function p(t){var e={};if(1==t.nodeType){if(t.attributes.length>0){e[\"@attributes\"]={};for(var n=0;n<t.attributes.length;n++){var r=t.attributes.item(n);e[\"@attributes\"][r.nodeName]=r.nodeValue}}}else 3==t.nodeType&&(e=t.nodeValue);if(t.hasChildNodes())for(var o=0;o<t.childNodes.length;o++){var i=t.childNodes.item(o),a=i.nodeName;if(\"undefined\"==typeof e[a])e[a]=p(i);else{if(\"undefined\"==typeof e[a].push){var u=e[a];e[a]=[],e[a].push(u)}e[a].push(p(i))}}return e}function v(){return navigator.serviceWorker?j[\"default\"].open(\"bart\",1,function(t){switch(t.version){case 1:t.createObjectStore(\"stations\",{keyPath:\"id\"}),t.createObjectStore(\"schedule\",{keyPath:[\"from\",\"to\"]}),t.createObjectStore(\"default\",{keyPath:\"id\"})}}):Promise.resolve()}function h(t,e){t&&e&&y(t,e).then(function(){m(t,e)})}function g(t){var e=I.value,n=M.value;if(e&&n){var r=d(P,e);r?S(I,!1):S(I,!0);var o=d(P,n);r&&o?(h(r,o),b(e,n)):D()}}function b(t,e){v().then(function(n){var r=n.transaction(\"default\",\"readwrite\").objectStore(\"default\"),o={id:\"from\",displayValue:t,value:d(P,t)},i={id:\"to\",displayValue:e,value:d(P,e)};r.put(o),r.put(i)})}function m(t,e){if(t&&e){var n=new Request(V.replace(\"%orig%\",t).replace(\"%dest%\",e));u(n).then(function(n){if(n.root.schedule.request){var r=i(n.root.schedule.request.trip);return x(r),v().then(function(n){if(n){var o=r;o.from=t,o.to=e;var i=n.transaction(\"schedule\",\"readwrite\").objectStore(\"schedule\");i.put(o)}})}})[\"catch\"](function(t){})}}function y(t,e){return v().then(function(n){if(n){var r=n.transaction(\"schedule\").objectStore(\"schedule\"),o=[t,e];return r.get(o).then(function(t){t?x(t):D()})[\"catch\"](function(t){D()})}})}function _(t){return t?W.replace(\"%depart-time%\",t.origTimeMin).replace(\"%arrival-time%\",t.destTimeMin).replace(\"%from-station%\",P[t.origin]).replace(\"%to-station%\",P[t.destination]).replace(\"%from-abbr%\",t.origin).replace(\"%to-abbr%\",t.destination):void 0}function x(t){N=!0,L=\"\",t.forEach(function(t){var e=\"\";if(t.leg.forEach)t.leg.forEach(function(n){\"\"!==e&&(e+=F);var r=\"\";r=1==t.leg.length?_(n).replace(\"<div><strong>Leg %leg-number%</strong></div>\",\"\").replace(\"<div><strong>Leg Duration:</strong> %leg-duration% mins</div>\",\"\"):_(n).replace(\"%leg-number%\",n.order).replace(\"%leg-duration%\",n.duration),e+=r});else{var n=_(t.leg).replace(\"<strong>Leg %leg-number%</strong>\",\"\");e+=n}L+=K.replace(\"%trip-duration%\",t.duration)+e+U}),B.innerHTML=L}function D(){N&&(N=!1,B.innerHTML=k)}function E(t){var e=I.value,n=M.value;if(e&&n){var r=d(P,e),o=d(P,n);o?S(M,!1):S(M,!0),r&&o?(h(r,o),b(e,n)):D()}}function w(){I.addEventListener(\"input\",g),M.addEventListener(\"input\",E)}function S(t,e){!e&&t.getAttribute(\"aria-invalid\")?t.removeAttribute(\"aria-invalid\"):e&&!t.getAttribute(\"aria-invalid\")&&t.setAttribute(\"aria-invalid\",\"true\")}var T=t(\"idb\"),j=r(T),I=document.getElementById(\"from-station\"),M=document.getElementById(\"to-station\"),B=document.getElementById(\"replace-me\"),q=document.getElementById(\"station-list\"),A='<option value=\"%value-data%\" abbreviation=\"%abbr-data%\">%abbr-data%</option>',C=\"\",O=new Request(\"http://api.bart.gov/api/stn.aspx?cmd=stns&key=MW9S-E7SL-26DU-VV8V\"),P={},V=\"http://api.bart.gov/api/sched.aspx?cmd=depart&orig=%orig%&dest=%dest%&key=MW9S-E7SL-26DU-VV8V\",L=\"\",k=\"<div>Schedule not available</div>\",N=!0,K='<div class=\"display-section\"><strong>Trip Duration:</strong> %trip-duration% mins',U=\"</div>\",W='<div class=\"flex-container flex-horizontal\"><div class = \"flex-2\"><div><strong>Leg %leg-number%</strong></div><div><strong>From:</strong> %from-station% (%from-abbr%)</div><div><strong>Departure:</strong> %depart-time%</div></div><div class = \"flex-1\"><div><strong>Leg Duration:</strong> %leg-duration% mins</div><div><strong>To:</strong> %to-station% (%to-abbr%)</div><div><strong>Arrival:</strong> %arrival-time%</div></div></div>',F=\"<hr>\";String.prototype.replaceAll=function(t,e){var n=this;return n.replace(new RegExp(t,\"g\"),e)},w(),l(),c().then(function(){s()})[\"catch\"](function(t){s()})},{idb:1}]},{},[2]);"],"file":"main.js","sourceRoot":"/source/"}